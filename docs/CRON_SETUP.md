# Cron Job Setup for Vercel

## Overview

Vercel has built-in cron job support. The cron jobs are already configured in `vercel.json` and will run automatically once deployed.

## Cron Jobs Configured

1. **Send Reminders** (runs every hour)
   - Path: `/api/cron/send-reminders`
   - Schedule: `0 * * * *` (every hour at minute 0)
   - Sends 24-hour and 2-hour appointment reminders

2. **Capture Payments** (runs every hour)
   - Path: `/api/cron/capture-payments`
   - Schedule: `0 * * * *` (every hour at minute 0)
   - Captures pre-authorized payments for confirmed appointments

3. **Process No-Shows** (runs every 30 minutes)
   - Path: `/api/cron/process-no-shows`
   - Schedule: `*/30 * * * *` (every 30 minutes)
   - Marks appointments as no-show and handles related actions

## Environment Variables Required

Add these to your Vercel project settings (https://vercel.com/your-project/settings/environment-variables):

```bash
# Required for cron authentication (Vercel generates this automatically)
CRON_SECRET=<auto-generated-by-vercel>

# For internal API authentication
INTERNAL_API_KEY=<generate-a-secure-random-string>

# For payment processing
STRIPE_SECRET_KEY=<your-stripe-secret-key>

# For email service (choose one)
RESEND_API_KEY=<your-resend-api-key>
# OR
SENDGRID_API_KEY=<your-sendgrid-api-key>

# Database (should already be set)
DATABASE_URL=<your-supabase-database-url>
NEXT_PUBLIC_SUPABASE_URL=<your-supabase-url>
SUPABASE_SERVICE_ROLE_KEY=<your-supabase-service-role-key>
```

## How Vercel Cron Jobs Work

1. **Automatic Authentication**: Vercel automatically adds the `CRON_SECRET` to requests made by its cron system
2. **No Manual Setup**: Unlike traditional cron jobs, you don't need to set up any external services
3. **Monitoring**: View cron job logs in your Vercel dashboard under the Functions tab
4. **Timezone**: All cron schedules use UTC time

## Testing Cron Jobs Locally

To test cron jobs locally:

```bash
# Set a test CRON_SECRET in your .env.local
CRON_SECRET=test-secret-123

# Call the endpoint with curl
curl -H "Authorization: Bearer test-secret-123" http://localhost:3000/api/cron/send-reminders
```

## Monitoring

1. **Vercel Dashboard**: 
   - Go to your project dashboard
   - Click on "Functions" tab
   - You'll see logs for each cron execution

2. **Error Alerts**:
   - Set up alerts in Vercel for failed cron jobs
   - Go to Settings > Notifications

## Cron Schedule Reference

- `0 * * * *` - Every hour at minute 0
- `*/30 * * * *` - Every 30 minutes
- `0 9 * * *` - Every day at 9 AM UTC
- `0 */6 * * *` - Every 6 hours

## Troubleshooting

1. **Cron not running?**
   - Check that `vercel.json` is properly formatted
   - Verify environment variables are set in Vercel dashboard
   - Check function logs for errors

2. **Authentication errors?**
   - Vercel automatically handles CRON_SECRET in production
   - Make sure you're not overriding the Authorization header

3. **Timeouts?**
   - Cron functions have a 60-second timeout configured
   - For longer operations, consider using queues or breaking into smaller jobs